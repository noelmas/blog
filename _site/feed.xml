<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Noelmas data doodles</title>
    <description>S</description>
    <link>http://noelmas.github.io/blog/</link>
    <atom:link href="http://noelmas.github.io/blog/feed.xml" rel="self" type="application/rss+xml" />
    
      <item>
        <title>Scraping PDF tables using ScraperWiki and Open Refine</title>
        <description>&lt;p&gt;Lots has been written as to why the PDF is inadequate format for data publication.&lt;sup&gt;&lt;a href=&quot;#1&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; PDFs aren’t machine readable and information from them often can’t even be copy and pasted. Despite this governments, corporations and multi-lateral organisations still release large amounts of public data as PDF. As a result, any organisation or individual wanting to analyse public data will have to extract structured data from PDFs at some point. A fantastic tool for doing this - and which requires no coding knowledge at all - is &lt;a href=&quot;http://scraperwiki.com&quot;&gt;ScraperWiki’s&lt;/a&gt; PDF table extract tool.&lt;sup&gt;&lt;a href=&quot;#2&quot;&gt;2&lt;/a&gt;&lt;/sup&gt; In combination with the data cleaning tool, &lt;a href=&quot;http://openrefine.org/&quot;&gt;Open Refine&lt;/a&gt;, you can wrangle most PDFs into an analysable form within minutes.&lt;/p&gt;

&lt;p&gt;The screencast below shows one method to turn the PDF of a UK investment sanctions list for Burmese companies into a spreadsheet. This kind of transformation would be useful if you wanted to automatically reconcile the list of companies with an external database such as &lt;a href=&quot;https://opencorporates.com/&quot;&gt;OpenCorporates&lt;/a&gt;,&lt;sup&gt;&lt;a href=&quot;#3&quot;&gt;3&lt;/a&gt;&lt;/sup&gt; see if any of organsiations appear in another dataset you’ve been compiling or map the locations of the companies. For this demo, we are aiming to create a spreadsheet that contains one organisation name and address per row. The screencast and instructions below walk through the steps:&lt;/p&gt;

&lt;object width=&quot;100%&quot;&gt;&lt;param name=&quot;movie&quot; value=&quot;http://www.youtube.com/v/GobC87hVvrQ&amp;amp;hl=en&amp;amp;fs=1&quot; /&gt;&lt;param name=&quot;allowFullScreen&quot; value=&quot;true&quot; /&gt;&lt;embed src=&quot;http://www.youtube.com/v/GobC87hVvrQ&amp;amp;hl=en&amp;amp;fs=1&quot; type=&quot;application/x-shockwave-flash&quot; allowfullscreen=&quot;true&quot; width=&quot;100%&quot; height=&quot;500&quot; /&gt;&lt;/object&gt;

&lt;p&gt; &lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Log-in to &lt;a href=&quot;http://scraperwiki.com&quot;&gt;ScraperWiki&lt;/a&gt; (create a free account if you don’t have one already), create a new dataset and choose the PDF Extract tool&lt;/li&gt;
  &lt;li&gt;Upload your PDF or paste in a web link to your PDF if it’s available publicly. For the purposes of this demo we will be using the sanctions list at &lt;a href=&quot;http://www.betterregulation.com/external/investmentban.pdf&quot;&gt;http://www.betterregulation.com/external/investmentban.pdf&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Download All Tables as an Excel spreadsheet&lt;/li&gt;
  &lt;li&gt;Open the spreadsheet in Excel, there will be a tab for each page of data in the PDF&lt;/li&gt;
  &lt;li&gt;Remove the header and footer information on each tab from each page&lt;/li&gt;
  &lt;li&gt;Start Open Refine and create a project with your spreadsheet&lt;/li&gt;
  &lt;li&gt;In preview mode, load each of the tabs that contains the data you are interested by ticking them (for brevity I’ve only turn the first 3 tabs)&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;In preview mode, our data does not have headers so untick the “Parse next X lines(s) as column headers”&lt;/p&gt;

    &lt;p&gt;&lt;em&gt;Open Refine recognises each of our lines from the table as a record despite the fact that it flows over multiple spreadsheet rows. As we are aiming to produce a spreadsheet with one organisation per line, we need to re-shape our data so the rows from our record that display “Organisation name” and “Address” have their own columns.&lt;/em&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;On “Column 2” choose the “Add a column based on this column function”. Insert the following bit of Google Refine Expressions Language (GREL):&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt; row.record.cells[&quot;Column 2&quot;][0].value
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Do this a second time except changing the 0 to a 1:&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt; row.record.cells[&quot;Column 2&quot;][1].value
&lt;/code&gt;&lt;/pre&gt;

    &lt;p&gt;&lt;em&gt;The newly created “Address” column retains some extra information that is not useful this time such as “Other information” (you may want to put this data into a new column). We are going to remove it. We would struggle to do this using a normal Find and Replace operation as the string we want to replace is different for every cell, however it does follow a pattern so we are able to use Regular Expressions.&lt;/em&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;In the “Address” column go to “Edit cells &amp;gt; Transform”, insert the following GREL expression that effectively finds all strings in that column that start with “Other information:” and are followed by an indefinite number of further characters. Regular Expressions are bounded by the “/” character in GREL:&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt; value.replace(/\sOther\sInformation.*/,&quot;&quot;)
&lt;/code&gt;&lt;/pre&gt;

    &lt;p&gt;&lt;em&gt;Now to get remove the extra lines in the records, so that we only have one line for each row of data.&lt;/em&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Choose the “Edit Cells &amp;gt; Blank down” function on the “Address” column effectively blanking out all consecutive duplicate rows for that column &lt;/li&gt;
  &lt;li&gt;Go to “Facet &amp;gt; Text Facet” on the “Address column”&lt;/li&gt;
  &lt;li&gt;Select from the Text Facet box “(blank)”, we need to remove all these rows&lt;/li&gt;
  &lt;li&gt;Change the view (top left) to “Rows” from “Records”&lt;/li&gt;
  &lt;li&gt;From the “All” function drop down (top left) select “Edit Cells &amp;gt; Remove all matching rows”&lt;/li&gt;
  &lt;li&gt;Finally, export you project using the button in the top right to either an Excel or CSV file. We now have the one row one record structure we were looking for. You can clean up your data furthers by taking out&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;a name=&quot;1&quot;&gt;&lt;/a&gt;[1] See for example &lt;a href=&quot;https://blog.scraperwiki.com/2013/12/the-tyranny-of-the-pdf/&quot;&gt;https://blog.scraperwiki.com/2013/12/the-tyranny-of-the-pdf/&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a name=&quot;2&quot;&gt;&lt;/a&gt;[2] ScraperWiki appears to be spinning this tool out as a separate product called &lt;a href=&quot;https://pdftables.com/&quot;&gt;PDF Tables&lt;/a&gt;, but you can still access the tool through ScraperWiki when this was written.&lt;/p&gt;
&lt;p&gt;&lt;a name=&quot;3&quot;&gt;&lt;/a&gt;[3] If you&#39;re interested in reconciling company names to the OpenCorporates database in order to attach the wealth information held by OpenCorporates to your database (e.g. director names, date of incorporation etc) take a look at &lt;a href=&quot;http://vimeo.com/17924204&quot;&gt;this&lt;/a&gt; tutorial.&lt;/p&gt;
</description>
        <pubDate>Sun, 21 Dec 2014 00:00:00 +0000</pubDate>
        <link>http://noelmas.github.io/blog/ddj-tips/scraping/2014/12/21/scraperwiki-pdf-extract-openrefine/</link>
        <guid isPermaLink="true">http://noelmas.github.io/blog/ddj-tips/scraping/2014/12/21/scraperwiki-pdf-extract-openrefine/</guid>
      </item>
    
      <item>
        <title>Identifying email domain patterns</title>
        <description>&lt;p&gt;This tip comes courtesy of Paul Myers who runs the brilliant &lt;a href=&quot;http://researchclinic.net/&quot;&gt;Research Clinic website&lt;/a&gt; that has a range of similar techniques for investigative reporters.&lt;/p&gt;

&lt;p&gt;A core part of journalism involves contacting people for the purposes of a story. It can often be difficult get hold of direct email addresses. One option is to intelligently guess them. In order to do this, you need to know the email and domain pattern that the organisation your individual is linked to uses. This is where &lt;a href=&quot;http://email-format.com/&quot;&gt;Email-Format.com&lt;/a&gt; comes in. You can search for any organisation and identify the format used for emails. Take the Open Knowledge Foundation for example - &lt;a href=&quot;http://email-format.com/d/okfn.org/&quot;&gt;http://email-format.com/d/okfn.org/&lt;/a&gt;. If you know that I currently work them and that my name is Sam Leon, it’s pretty straight forward to get my email address.&lt;/p&gt;

&lt;center&gt;&lt;iframe src=&quot;https://docs.google.com/file/d/0B3m0VSUa2b5mLUxlUFdxSVB0aVk/preview&quot; width=&quot;640&quot; height=&quot;480&quot;&gt;&lt;/iframe&gt;&lt;/center&gt;

</description>
        <pubDate>Wed, 17 Dec 2014 00:00:00 +0000</pubDate>
        <link>http://noelmas.github.io/blog/ddj-tips/2014/12/17/email-formats/</link>
        <guid isPermaLink="true">http://noelmas.github.io/blog/ddj-tips/2014/12/17/email-formats/</guid>
      </item>
    
      <item>
        <title>Scraping Royal Mail search box</title>
        <description>&lt;p&gt;Earlier in the week I had to find a list of all addresses on a given street. After chasing a few deadends that involved vists to the Ordnance Survey website and having a look if the Google Maps API could help, I found a neat trick that uses the most authoratitive source for this kind of information: &lt;a href=&quot;http://www.royalmail.com/find-a-postcode&quot;&gt;Royal Mail&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The screencast below shows how to do it using the Google Chrome &lt;a href=&quot;https://chrome.google.com/webstore/detail/scraper/mbigbapnjcgaffohmbkdlecaccepngjd&quot;&gt;Scraper&lt;/a&gt; plug-in. It’s a bit of a hack and doesn’t give you all flat addresses in one table, but is a great start for grabbing this kind of information.&lt;/p&gt;

&lt;object width=&quot;100%&quot;&gt;&lt;param name=&quot;movie&quot; value=&quot;http://www.youtube.com/v/VpruUcsk0Z0&amp;amp;hl=en&amp;amp;fs=1&quot; /&gt;&lt;param name=&quot;allowFullScreen&quot; value=&quot;true&quot; /&gt;&lt;embed src=&quot;http://www.youtube.com/v/VpruUcsk0Z0&amp;amp;hl=en&amp;amp;fs=1&quot; type=&quot;application/x-shockwave-flash&quot; allowfullscreen=&quot;true&quot; width=&quot;100%&quot; height=&quot;500&quot; /&gt;&lt;/object&gt;
</description>
        <pubDate>Thu, 11 Dec 2014 00:00:00 +0000</pubDate>
        <link>http://noelmas.github.io/blog/scraping/2014/12/11/scraping-royal-mail/</link>
        <guid isPermaLink="true">http://noelmas.github.io/blog/scraping/2014/12/11/scraping-royal-mail/</guid>
      </item>
    
  </channel>
</rss>
